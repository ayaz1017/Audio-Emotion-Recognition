<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Psychiatric Session Report</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="bg-gray-900 text-gray-200 min-h-screen">

<div class="max-w-7xl mx-auto px-6 py-8">

    <!-- HEADER -->
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-white">
            üß† Psychiatric Session Report
        </h1>
        <p class="text-sm text-gray-400 mt-1">
            Patient ID: <span class="font-semibold text-blue-400">{{ patient_id }}</span>
        </p>
    </div>

    <!-- SUMMARY CARDS -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">

        <div class="bg-gray-800 border border-gray-700 rounded-xl p-5">
            <p class="text-sm text-gray-400">Dominant Emotion</p>
            <p class="text-2xl font-bold text-blue-400 mt-2">
                {{ prediction_text }}
            </p>
        </div>

        <div class="bg-gray-800 border border-gray-700 rounded-xl p-5">
            <p class="text-sm text-gray-400">Average Confidence</p>
            <p class="text-2xl font-bold text-green-400 mt-2">
                {{ prediction_conf }}
            </p>
        </div>

        <div class="bg-gray-800 border border-gray-700 rounded-xl p-5">
            <p class="text-sm text-gray-400">Emotional Instability</p>
            <p class="text-2xl font-bold text-red-400 mt-2">
                {{ instability }}
            </p>
        </div>

    </div>

 
    <div class="bg-gray-800 border border-gray-700 rounded-xl p-6 mb-10">
        <h2 class="text-xl font-semibold text-white mb-4">
            üìä Emotion Confidence Timeline
        </h2>
        <canvas id="timelineChart" class="w-full h-80"></canvas>
    </div>

    <!-- SPEECH BIOMARKERS -->
    <div class="bg-gray-800 border border-gray-700 rounded-xl p-6 mb-10">
        <h2 class="text-xl font-semibold text-white mb-4">
            üó£Ô∏è Speech Biomarkers
        </h2>

        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
            <div class="bg-gray-900 rounded-lg p-4">
                <p class="text-sm text-gray-400">Speech Rate</p>
                <p class="text-lg font-semibold text-blue-300">{{ speech.speech_rate }}</p>
            </div>

            <div class="bg-gray-900 rounded-lg p-4">
                <p class="text-sm text-gray-400">Silence Ratio</p>
                <p class="text-lg font-semibold text-yellow-300">{{ speech.silence_ratio }}</p>
            </div>

            <div class="bg-gray-900 rounded-lg p-4">
                <p class="text-sm text-gray-400">RMS Energy</p>
                <p class="text-lg font-semibold text-green-300">{{ speech.rms_energy }}</p>
            </div>

            <div class="bg-gray-900 rounded-lg p-4">
                <p class="text-sm text-gray-400">Pitch Variability</p>
                <p class="text-lg font-semibold text-purple-300">{{ speech.pitch_variability }}</p>
            </div>
        </div>
    </div>


    {% if risks %}
    <div class="bg-red-900/30 border border-red-700 rounded-xl p-6 mb-10">
        <h2 class="text-xl font-semibold text-red-300 mb-3">
            ‚ö† Behavioral Risk Indicators
        </h2>
        <ul class="list-disc list-inside space-y-1 text-red-200">
            {% for r in risks %}
            <li>{{ r }}</li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}


    <div class="bg-gray-800 border border-gray-700 rounded-xl p-6 mb-10">
        <h2 class="text-xl font-semibold text-white mb-3">
            üìà Longitudinal Trend
        </h2>
        <p class="text-gray-300 leading-relaxed">
            {{ trend }}
        </p>
    </div>


    <div class="bg-gray-800 border border-gray-700 rounded-xl p-6 mb-10">
        <h2 class="text-xl font-semibold text-white mb-3">
            üßæ Clinical Session Summary
        </h2>
        <pre class="whitespace-pre-wrap text-gray-300 text-sm">
{{ clinical_summary }}
        </pre>
    </div>


    <div class="bg-gray-800 border border-gray-700 rounded-xl p-6 mb-10">
        <h2 class="text-xl font-semibold text-white mb-4">
            üìÖ Patient History (Last 5 Sessions)
        </h2>

        {% if history %}
        <div class="overflow-x-auto">
            <table class="min-w-full text-sm">
                <thead class="bg-gray-900">
                    <tr>
                        <th class="px-4 py-2 text-left text-gray-400">Date</th>
                        <th class="px-4 py-2 text-left text-gray-400">Emotion</th>
                        <th class="px-4 py-2 text-left text-gray-400">Confidence</th>
                        <th class="px-4 py-2 text-left text-gray-400">Instability</th>
                    </tr>
                </thead>
                <tbody>
                    {% for h in history %}
                    <tr class="border-t border-gray-700">
                        <td class="px-4 py-2">{{ h.date }}</td>
                        <td class="px-4 py-2">{{ h.emotion }}</td>
                        <td class="px-4 py-2">{{ h.confidence }}</td>
                        <td class="px-4 py-2">{{ h.instability }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p class="text-gray-400">No previous sessions available.</p>
        {% endif %}
    </div>


    <a href="/" class="inline-block bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold">
        ‚¨Ö Back to Dashboard
    </a>

</div>


<script>
    const timeline = {{ emotion_timeline | tojson | safe }};

    if (timeline && timeline.length > 0) {
        const labels = timeline.map(t => `${t.start}-${t.end}s`);
        const confidences = timeline.map(t => t.confidence);

        new Chart(document.getElementById("timelineChart"), {
            type: "line",
            data: {
                labels: labels,
                datasets: [{
                    data: confidences,
                    borderColor: "#60a5fa",
                    borderWidth: 2,
                    tension: 0.3,
                    pointRadius: 4
                }]
            },
            options: {
                responsive: true,
                plugins: { legend: { display: false } },
                scales: { y: { min: 0, max: 1 } }
            }
        });
    }
</script>

</body>
</html>

